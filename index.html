<html>

<body>
  <p id='server-time'></p>
  <p id='room-message'></p>
  <p> Rooms </p>
  <div id='rooms'>
  </div>
  <div> 
    <div id="chat_room">

    </div>
    <input type="text" id="chat_input"/>
    <button onclick="sendChat()">Send</button>
  </div>
  <button onclick="createRoom()">createRoom</button>
  <button onclick="listRoom()">listRoom</button>
  <script src="/socket.io/socket.io.js"></script>
<script type='text/javascript' src='https://code.jquery.com/jquery-3.3.1.slim.min.js'></script>
  <script>
    var socket = io();
    var el = document.getElementById('server-time');
    var roomMessage = document.getElementById('room-message');
    var roomsDiv = document.getElementById('rooms');
    var renderListRoom = function (rooms) {
      var roomsHtml = '';
      roomsHtml = rooms.map(room => {
        return '<p>' + room.name + " | " + room.num + "</p>" +
          `<button onclick="joinRoom('${room.socketid}')"> JOIN </button>`
      }).join('')

      roomsDiv.innerHTML = roomsHtml
    }
    socket.on('time', function (timeString) {
      el.innerHTML = 'Server time: ' + timeString;
    });
    socket.on('private_message', function (data) {
      switch (data.type) {
        case 'rooms':
          renderListRoom(data.message);
          break;
        default:
          console.log(data)
      }
    });
    socket.on('room_message', function (data) {
      switch (data.type) {
        case 'chat_room': 
          $('#chat_room').text(data.message)
          break
        default:
          roomMessage.innerText = data.type + "|" + JSON.stringify(data.message)
      }
    })
    var createRoom = function () {
      socket.emit('create room', 'world2');
    }
    var listRoom = function () {
      socket.emit('list room', '');
    }
    var joinRoom = function (id) {
      socket.emit('join room', id);
    }
    var sendChat = function(){
      socket.emit('chat room', $('#chat_input').val())
    }
  </script>
</body>

</html>